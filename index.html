<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Gnosia Simulator</title>
<style>
  body { background: #111; color: #eee; font-family: monospace; padding: 20px; }
  fieldset { margin-bottom: 10px; }
  input, select, button { margin: 2px; }
  #charList { list-style: none; padding: 0; }
  #charList li { border: 1px solid #444; margin-bottom: 4px; padding: 4px; }
  #log { border: 1px solid #444; height: 200px; overflow-y: auto; padding: 5px; background: #000; }
  label { display: block; margin-top: 4px; }
  .stat-input { width: 50px; }
</style>
</head>
<body>

<h1>그노시아 시뮬레이터</h1>

<h2>캐릭터 생성</h2>
<label>이름: <input id="name"></label>
<label>성별: 
<select id="gender">
  <option value="남성">남성</option>
  <option value="여성">여성</option>
  <option value="범성">범성</option>
</select></label>
<label>나이: <input id="age" type="number" min="0"></label>

<fieldset>
  <legend>스테이터스 (0~50)</legend>
  <label>카리스마: <input id="charisma" type="number" min="0" max="50" class="stat-input"></label>
  <label>논리력: <input id="logic" type="number" min="0" max="50" class="stat-input"></label>
  <label>연기력: <input id="acting" type="number" min="0" max="50" class="stat-input"></label>
  <label>귀염성: <input id="charm" type="number" min="0" max="50" class="stat-input"></label>
  <label>스텔스: <input id="stealth" type="number" min="0" max="50" class="stat-input"></label>
  <label>직감: <input id="intuition" type="number" min="0" max="50" class="stat-input"></label>
</fieldset>

<fieldset>
  <legend>성격 (0.00~1.00)</legend>
  <label>쾌활함: <input id="cheer" type="number" min="0" max="1" step="0.01" class="stat-input"></label>
  <label>사회성: <input id="social" type="number" min="0" max="1" step="0.01" class="stat-input"></label>
  <label>논리성향: <input id="logical" type="number" min="0" max="1" step="0.01" class="stat-input"></label>
  <label>상냥함: <input id="kindness" type="number" min="0" max="1" step="0.01" class="stat-input"></label>
  <label>욕망: <input id="desire" type="number" min="0" max="1" step="0.01" class="stat-input"></label>
  <label>용기: <input id="courage" type="number" min="0" max="1" step="0.01" class="stat-input"></label>
</fieldset>

<fieldset>
  <legend>사용 가능한 커맨드 체크</legend>
  <div id="commandChecks"></div>
</fieldset>

<button id="addChar">캐릭터 추가</button>
<button id="runBtn" disabled>실행</button>

<h2>캐릭터 목록</h2>
<ul id="charList"></ul>

<h2>로그</h2>
<div id="log"></div>

<h2>세이브 / 로드</h2>
<button id="saveBtn">세이브</button>
<input type="file" id="loadFile">
<button id="loadBtn">로드</button>

<script>
const commands = [
  "의심한다", "의심에 동의한다", "부정한다", "변호한다", "변호에 가담한다", 
  "감싼다", "함께 감싼다", "감사한다", "반론한다", "반론에 가담한다", 
  "시끄러워", "역할을 밝힌다", "자신도 밝힌다", "역할을 밝혀라", "과장해서 말한다", 
  "동의를 구한다", "반론을 막는다", "얼버무린다", "반격한다", "도움 요청한다", 
  "슬퍼한다", "속지마라", "투표해라", "투표하지 마라", "반드시 인간이다", 
  "반드시 적이다", "전원 배제해라", "잡담한다", "협력하자", "인간이라고 말해", "도게자한다"
];

let characters = [];

const addCharBtn = document.getElementById("addChar");
const runBtn = document.getElementById("runBtn");
const charList = document.getElementById("charList");
const logDiv = document.getElementById("log");
const commandChecksDiv = document.getElementById("commandChecks");

function refreshCommandChecks() {
  commandChecksDiv.innerHTML = "";
  commands.forEach(cmd => {
    const label = document.createElement("label");
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.dataset.command = cmd;
    label.appendChild(checkbox);
    label.appendChild(document.createTextNode(cmd));
    commandChecksDiv.appendChild(label);
  });
}

function refreshCharList() {
  charList.innerHTML = "";
  characters.forEach((c, idx) => {
    const li = document.createElement("li");
    li.textContent = `${c.name} (${c.gender}, ${c.age}세)`;
    const cmds = document.createElement("div");
    cmds.textContent = "선택 커맨드: " + c.commands.join(", ");
    li.appendChild(cmds);
    charList.appendChild(li);
  });
  runBtn.disabled = characters.length < 5;
}

addCharBtn.addEventListener("click", () => {
  const c = {
    name: document.getElementById("name").value || "이름 없음",
    gender: document.getElementById("gender").value,
    age: Math.max(0, parseInt(document.getElementById("age").value) || 0),
    charisma: Math.min(50, Math.max(0, parseInt(document.getElementById("charisma").value)||0)),
    logic: Math.min(50, Math.max(0, parseInt(document.getElementById("logic").value)||0)),
    acting: Math.min(50, Math.max(0, parseInt(document.getElementById("acting").value)||0)),
    charm: Math.min(50, Math.max(0, parseInt(document.getElementById("charm").value)||0)),
    stealth: Math.min(50, Math.max(0, parseInt(document.getElementById("stealth").value)||0)),
    intuition: Math.min(50, Math.max(0, parseInt(document.getElementById("intuition").value)||0)),
    cheer: Math.min(1, Math.max(0, parseFloat(document.getElementById("cheer").value)||0)),
    social: Math.min(1, Math.max(0, parseFloat(document.getElementById("social").value)||0)),
    logical: Math.min(1, Math.max(0, parseFloat(document.getElementById("logical").value)||0)),
    kindness: Math.min(1, Math.max(0, parseFloat(document.getElementById("kindness").value)||0)),
    desire: Math.min(1, Math.max(0, parseFloat(document.getElementById("desire").value)||0)),
    courage: Math.min(1, Math.max(0, parseFloat(document.getElementById("courage").value)||0)),
    commands: Array.from(document.querySelectorAll("#commandChecks input:checked")).map(cb => cb.dataset.command)
  };
  characters.push(c);
  refreshCharList();
  log("캐릭터 추가됨: " + c.name);
});

runBtn.addEventListener("click", () => {
  log("게임 실행! 현재 캐릭터 수: " + characters.length);
  // 여기에 실제 시뮬레이션 로직을 추가 가능
});

function log(msg) {
  const p = document.createElement("p");
  p.textContent = msg;
  logDiv.appendChild(p);
  logDiv.scrollTop = logDiv.scrollHeight;
}

// 초기 커맨드 체크 UI 생성
refreshCommandChecks();

// 세이브/로드
document.getElementById("saveBtn").addEventListener("click", () => {
  const data = JSON.stringify(characters);
  const blob = new Blob([data], {type: "application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "characters.json";
  a.click();
});

document.getElementById("loadBtn").addEventListener("click", () => {
  const fileInput = document.getElementById("loadFile");
  if (!fileInput.files[0]) { alert("파일 선택 필요"); return; }
  const reader = new FileReader();
  reader.onload = e => {
    characters = JSON.parse(e.target.result);
    refreshCharList();
    log("캐릭터 로드 완료");
  };
  reader.readAsText(fileInput.files[0]);
});
</script>

</body>
</html>
