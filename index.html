<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>그노시아 시뮬레이터 통합판</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: monospace;
      padding: 20px;
    }
    input, select, button {
      margin: 4px;
    }
    fieldset {
      margin-bottom: 10px;
    }
    #log {
      border: 1px solid #444;
      height: 200px;
      overflow-y: auto;
      padding: 5px;
      background: #000;
    }
    #charList li {
      margin-bottom: 5px;
    }
    .label {
      display: block;
      font-weight: bold;
    }
    canvas {
      background: #222;
      display: block;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>그노시아 시뮬레이터 통합판</h1>

<h2>게임 설정</h2>
<fieldset>
  <legend>역할 설정</legend>
  <label><input type="checkbox" id="engineer" checked> 엔지니어</label>
  <label><input type="checkbox" id="doctor" checked> 닥터</label>
  <label><input type="checkbox" id="guardian" checked> 수호천사</label>
  <label><input type="checkbox" id="waiter" checked> 선내대기인</label>
  <label><input type="checkbox" id="ac" checked> AC주의자</label>
  <label><input type="checkbox" id="bug" checked> 버그</label>
</fieldset>
<label class="label">그노시아 수</label>
<input type="number" id="gnosiaCount" min="1" max="6" value="1">

<h2>캐릭터 생성</h2>
<label class="label">이름</label>
<input id="name" placeholder="이름">
<label class="label">성별</label>
<select id="gender">
  <option value="남성">남성</option>
  <option value="여성">여성</option>
  <option value="범성">범성</option>
</select>
<label class="label">나이</label>
<input id="age" type="number" min="0" placeholder="나이">

<fieldset>
  <legend>스테이터스 (0~50)</legend>
  <label class="label">카리스마</label>
  <input id="charisma" type="number" min="0" max="50" placeholder="카리스마">
  <label class="label">논리력</label>
  <input id="logic" type="number" min="0" max="50" placeholder="논리력">
  <label class="label">연기력</label>
  <input id="acting" type="number" min="0" max="50" placeholder="연기력">
  <label class="label">귀염성</label>
  <input id="charm" type="number" min="0" max="50" placeholder="귀염성">
  <label class="label">스텔스</label>
  <input id="stealth" type="number" min="0" max="50" placeholder="스텔스">
  <label class="label">직감</label>
  <input id="intuition" type="number" min="0" max="50" placeholder="직감">
</fieldset>

<fieldset>
  <legend>성격 (0.00~1.00)</legend>
  <label class="label">쾌활함</label>
  <input id="cheer" type="number" min="0" max="1" step="0.01" placeholder="쾌활함">
  <label class="label">사회성</label>
  <input id="social" type="number" min="0" max="1" step="0.01" placeholder="사회성">
  <label class="label">논리성향</label>
  <input id="logical" type="number" min="0" max="1" step="0.01" placeholder="논리성향">
  <label class="label">상냥함</label>
  <input id="kindness" type="number" min="0" max="1" step="0.01" placeholder="상냥함">
  <label class="label">욕망</label>
  <input id="desire" type="number" min="0" max="1" step="0.01" placeholder="욕망">
  <label class="label">용기</label>
  <input id="courage" type="number" min="0" max="1" step="0.01" placeholder="용기">
</fieldset>

<button id="addChar">캐릭터 추가</button>
<button id="runBtn" disabled>실행</button>
<button id="saveBtn">세이브</button>
<input type="file" id="loadFile">

<h2>캐릭터 목록</h2>
<ul id="charList"></ul>

<h2>관계도</h2>
<canvas id="relationCanvas" width="600" height="400"></canvas>

<h2>로그</h2>
<div id="log"></div>

<script>
let characters = [];

function log(message) {
  const logDiv = document.getElementById("log");
  logDiv.innerHTML += message + "<br>";
  logDiv.scrollTop = logDiv.scrollHeight;
}

function updateCharList() {
  const list = document.getElementById("charList");
  list.innerHTML = "";
  characters.forEach((c, i) => {
    const li = document.createElement("li");
    li.textContent = `${c.name} | ${c.gender} | 나이:${c.age} | 카:${c.charisma} 논:${c.logic} 연:${c.acting} 귀:${c.charm} 스:${c.stealth} 직:${c.intuition} | 성격: 쾌:${c.cheer} 사:${c.social} 논:${c.logical} 상:${c.kindness} 욕:${c.desire} 용:${c.courage}`;
    list.appendChild(li);
  });
}

function drawRelations() {
  const canvas = document.getElementById("relationCanvas");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const radius = 20;
  const cx = canvas.width/2;
  const cy = canvas.height/2;
  const step = 2 * Math.PI / characters.length;
  characters.forEach((c, i) => {
    const x = cx + 150 * Math.cos(i*step);
    const y = cy + 150 * Math.sin(i*step);
    c.pos = {x, y};
    ctx.beginPath();
    ctx.arc(x,y,radius,0,2*Math.PI);
    ctx.fillStyle = "#0f0";
    ctx.fill();
    ctx.fillStyle = "#fff";
    ctx.fillText(c.name, x-15, y+5);
  });
  // 간단한 선 표시 (우호도, 신뢰도 랜덤)
  for(let i=0;i<characters.length;i++){
    for(let j=i+1;j<characters.length;j++){
      ctx.beginPath();
      ctx.moveTo(characters[i].pos.x, characters[i].pos.y);
      ctx.lineTo(characters[j].pos.x, characters[j].pos.y);
      ctx.strokeStyle = "rgba(255,255,255,0.2)";
      ctx.stroke();
    }
  }
}

document.getElementById("addChar").addEventListener("click",()=>{
  const c = {
    name: document.getElementById("name").value || "무명",
    gender: document.getElementById("gender").value,
    age: Math.max(0,parseInt(document.getElementById("age").value)||0),
    charisma: Math.min(50,Math.max(0,parseInt(document.getElementById("charisma").value)||0)),
    logic: Math.min(50,Math.max(0,parseInt(document.getElementById("logic").value)||0)),
    acting: Math.min(50,Math.max(0,parseInt(document.getElementById("acting").value)||0)),
    charm: Math.min(50,Math.max(0,parseInt(document.getElementById("charm").value)||0)),
    stealth: Math.min(50,Math.max(0,parseInt(document.getElementById("stealth").value)||0)),
    intuition: Math.min(50,Math.max(0,parseInt(document.getElementById("intuition").value)||0)),
    cheer: Math.min(1,Math.max(0,parseFloat(document.getElementById("cheer").value)||0)),
    social: Math.min(1,Math.max(0,parseFloat(document.getElementById("social").value)||0)),
    logical: Math.min(1,Math.max(0,parseFloat(document.getElementById("logical").value)||0)),
    kindness: Math.min(1,Math.max(0,parseFloat(document.getElementById("kindness").value)||0)),
    desire: Math.min(1,Math.max(0,parseFloat(document.getElementById("desire").value)||0)),
    courage: Math.min(1,Math.max(0,parseFloat(document.getElementById("courage").value)||0)),
  };
  characters.push(c);
  updateCharList();
  drawRelations();
  document.getElementById("runBtn").disabled = characters.length===0;
  log(`캐릭터 ${c.name} 추가됨.`);
});

document.getElementById("runBtn").addEventListener("click",()=>{
  log("시뮬레이션 실행됨 (임시 로그)");
});

document.getElementById("saveBtn").addEventListener("click",()=>{
  const data = JSON.stringify(characters);
  const blob = new Blob([data], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "characters.json";
  a.click();
  URL.revokeObjectURL(url);
  log("캐릭터 목록 저장됨.");
});

document.getElementById("loadFile").addEventListener("change",(e)=>{
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function() {
    characters = JSON.parse(reader.result);
    updateCharList();
    drawRelations();
    log("캐릭터 목록 불러오기 완료.");
  };
  reader.readAsText(file);
});
</script>
</body>
</html>

